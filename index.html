<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>æ‹æ‰‹ãƒšãƒ¼ã‚¸</title>

<style>
body {
  font-family: sans-serif;
  max-width: 500px;
  margin: 0 auto;
  padding: 20px;
  text-align: center;
}
img {
  max-width: 100%;
  border-radius: 10px;
  margin-bottom: 20px;
}
textarea {
  width: 100%;
  height: 80px;
  margin-top: 10px;
  padding: 10px;
}
button {
  padding: 10px 18px;
  border: none;
  border-radius: 6px;
  font-size: 16px;
  cursor: pointer;
  color: #fff;
}
.send-btn {
  background-color: #6fa8ff;
  margin-top: 10px;
}
#count {
  font-size: 18px;
  margin-top: 15px;
}
</style>
</head>

<body>

<h2>ğŸ‰ å¿œæ´ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã™ ğŸ‰</h2>

<!-- â–¼ ãŠç¤¼ç”»åƒï¼ˆè‡ªç”±ã«å¤‰æ›´ï¼ï¼‰ -->
<img src="https://placehold.co/400x250?text=THANK+YOU" alt="ãŠç¤¼ã‚¤ãƒ©ã‚¹ãƒˆ">

<p id="count">æ‹æ‰‹æ•°ï¼šèª­ã¿è¾¼ã¿ä¸­...</p>

<hr>

<h3>ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’é€ã‚‹</h3>
<textarea id="message" placeholder="ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒã‚ã‚Œã°ã©ã†ãï¼"></textarea><br>
<button class="send-btn" id="sendMsgBtn">ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸é€ä¿¡</button>

<!-- â–¼ Firebase SDKï¼ˆã‚ãªãŸã®è²¼ã£ãŸ type=module æ–¹å¼ï¼‰ -->
<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-app.js";
  import { getFirestore, doc, getDoc, setDoc, updateDoc, collection, addDoc } 
      from "https://www.gstatic.com/firebasejs/12.6.0/firebase-firestore.js";

  const firebaseConfig = {
    apiKey: "AIzaSyC74BiEEMF1D8C7Ll99kWBJE5UqTC8T8Hw",
    authDomain: "kado-onyx-clap.firebaseapp.com",
    projectId: "kado-onyx-clap",
    storageBucket: "kado-onyx-clap.firebasestorage.app",
    messagingSenderId: "1038961543704",
    appId: "1:1038961543704:web:114b43697f055c2f8f116d",
    measurementId: "G-DH6JB7CKPV"
  };

  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);

  // â–¼ claps/main ã«æ‹æ‰‹æ•°ã‚’ä¿å­˜
  const clapDocRef = doc(db, "claps", "main");

  // â–  ãƒšãƒ¼ã‚¸ã‚’é–‹ã„ãŸç¬é–“ã« +1 ã™ã‚‹å‡¦ç†
  async function autoClap() {
    const snap = await getDoc(clapDocRef);

    if (snap.exists()) {
      await updateDoc(clapDocRef, {
        count: snap.data().count + 1
      });
    } else {
      await setDoc(clapDocRef, { count: 1 });
    }

    updateCount();
  }

  // â–  ç¾åœ¨ã®æ‹æ‰‹æ•°ã‚’åæ˜ 
  async function updateCount() {
    const snap = await getDoc(clapDocRef);
    const count = snap.exists() ? snap.data().count : 0;
    document.getElementById("count").textContent = "æ‹æ‰‹æ•°ï¼š" + count;
  }

  // â–¼ è‡ªå‹•ã§æ‹æ‰‹ã‚’ã‚«ã‚¦ãƒ³ãƒˆ
  autoClap();

  // â–¼ ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸é€ä¿¡
  document.getElementById("sendMsgBtn").onclick = async () => {
    const text = document.getElementById("message").value.trim();
    if (!text) {
      alert("ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒç©ºã§ã™ï¼");
      return;
    }

    await addDoc(collection(db, "messages"), {
      text: text,
      timestamp: new Date()
    });

    alert("ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’é€ä¿¡ã—ã¾ã—ãŸï¼");
    document.getElementById("message").value = "";
  };
</script>

</body>
</html>
