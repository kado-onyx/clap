<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>æ‹æ‰‹ãƒšãƒ¼ã‚¸</title>

<style>
body {
  font-family: sans-serif;
  background-color: #9370db;
  margin: 0;
  padding: 20px;
  text-align: center;
  color: #fff;
}

#image-box img {
  max-width: 90%;
  margin: 20px auto;
  display: block;
}

textarea {
  width: 50%;
  height: 80px;
  padding: 10px;
  margin-top: 10px;
  border-radius: 6px;
  border: none;
  font-size: 16px;
}

button {
  padding: 12px 22px;
  margin-top: 10px;
  border: none;
  border-radius: 6px;
  background-color: #282828;
  font-size: 16px;
  cursor: pointer;
  color: #fff;
}

#page-num {
  margin-top: 10px;
  font-size: 18px;
}

</style>
</head>

<body>

<h2 style="color:#000;">ğŸ’€æ‹æ‰‹ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã™ğŸ‘¹</h2>

<div id="image-box">
  <img id="main-image" src="1.png" alt="ãŠç¤¼ç”»åƒ">
</div>

<div id="page-num">(1/3)</div>

<textarea id="message" placeholder="ãªã«ã‹ã”ã–ã„ã¾ã—ãŸã‚‰"></textarea><br>
<button id="sendClapBtn">é€ä¿¡</button>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-app.js";
  import { getFirestore, doc, getDoc, setDoc, updateDoc, collection, addDoc } 
    from "https://www.gstatic.com/firebasejs/12.6.0/firebase-firestore.js";

  const firebaseConfig = {
    apiKey: "AIzaSyC74BiEEMF1D8C7Ll99kWBJE5UqTC8T8Hw",
    authDomain: "kado-onyx-clap.firebaseapp.com",
    projectId: "kado-onyx-clap",
    storageBucket: "kado-onyx-clap.firebasestorage.app",
    messagingSenderId: "1038961543704",
    appId: "1:1038961543704:web:114b43697f055c2f8f116d",
    measurementId: "G-DH6JB7CKPV"
  };

  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);

  const clapDocRef = doc(db, "claps", "main");

  // â–¼ æ‹æ‰‹ +1
  async function addClap() {
    const snap = await getDoc(clapDocRef);
    if (snap.exists()) {
      await updateDoc(clapDocRef, { count: snap.data().count + 1 });
    } else {
      await setDoc(clapDocRef, { count: 1 });
    }
  }

  // â–¼ ãƒ­ãƒ¼ã‚«ãƒ«é€£æ‰“ã‚«ã‚¦ãƒ³ã‚¿ãƒ¼ãƒ»ã‚¯ãƒ¼ãƒ«ãƒ€ã‚¦ãƒ³æ©Ÿèƒ½
  function canClapNow() {
    const key = "clapCount";
    const lastClapTimeKey = "lastClapTime";

    let count = Number(localStorage.getItem(key) || 0);
    let lastTime = Number(localStorage.getItem(lastClapTimeKey) || 0);
    const now = Date.now();

    if (count < 10) {
      localStorage.setItem(key, count + 1);
      return true;
    }

    if (now - lastTime >= 3000) {
      localStorage.setItem(lastClapTimeKey, now);
      return true;
    }

    return false;
  }

  // â–¼ ç”»åƒåˆ‡æ›¿
  const images = ["1.gif", "2.png", "3.png", "4.png"];
  let idx = 0;

function updateImage() {
  const img = document.getElementById("thankImage");
  img.src = images[currentIndex];

  // ãƒšãƒ¼ã‚¸ç•ªå·è¡¨ç¤º
  const pageText = `${currentIndex + 1} / ${images.length}`;
  document.getElementById("pageNumber").textContent = pageText;

  // æ¬¡ã®ãƒšãƒ¼ã‚¸ã¸
  currentIndex = (currentIndex + 1) % images.length;
}

  // â–¼ ãƒ¡ã‚¤ãƒ³ãƒœã‚¿ãƒ³å‡¦ç†ï¼ˆæ‹æ‰‹ + ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ + æ¬¡ç”»åƒï¼‰
document.getElementById("clapButton").addEventListener("click", async () => {

  // 15å›ã¾ã§ã¯ã‚¯ãƒ¼ãƒ«ãƒ€ã‚¦ãƒ³ãªã—
  if (rapidClicks < maxRapid) {
    rapidClicks++;
  } else {
    alert("ãŠã¡ã¤ã„ã¦ãã ã•ã„");
    return;
  }

  // æ‹æ‰‹å‡¦ç†
  await addClapToFirebase(); // â†ã‚ãªãŸã®æ—¢å­˜ã®æ‹æ‰‹ã‚«ã‚¦ãƒ³ãƒˆå‡¦ç†
  updateImage();

  // 60ç§’ã§é€£æ‰“å›æ•°ãƒªã‚»ãƒƒãƒˆï¼ˆè‡ªç”±ã«å¤‰æ›´å¯ï¼‰
  setTimeout(() => {
    rapidClicks = 0;
  }, 60000);
});

    }

    await addClap();

    idx = (idx + 1) % images.length;
    updateImage();

    document.getElementById("message").value = "";
  };

  updateImage();
</script>

</body>
</html>
<p style="color:#000; margin-top:30px; font-size:14px;">
Â© 2021 yawaraka_doku_onyx All Rights Reserved.
</p>
